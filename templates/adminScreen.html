<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>SHEMS Admin Dashboard</title>

<style>
:root{
  --bg:#f5f7fb;
  --card:#ffffff;
  --text:#1f2937;
  --muted:#6b7280;
  --primary:#2563eb;
  --sidebar:#0f172a;
}

body.dark{
  --bg:#0b1220;
  --card:#111827;
  --text:#f8fafc;
  --muted:#9ca3af;
  --primary:#3b82f6;
}

body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:.3s;
}

/* Sidebar */
.sidebar{
 width:220px;
 height:100vh;
 background:var(--sidebar);
 color:white;
 position:fixed;
 padding-top:30px;
}
.sidebar h2{
 text-align:center;
 margin-bottom:30px;
 letter-spacing:1px;
}
.sidebar a{
 display:block;
 color:#cbd5e1;
 padding:12px 25px;
 text-decoration:none;
 font-size:15px;
}
.sidebar a:hover{background:#1e293b;color:white}

/* Header */
.header{
 margin-left:220px;
 background:var(--primary);
 color:white;
 padding:20px 30px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}
.header h1{margin:0;font-size:22px}

/* Theme Switch */
.theme-switch{
 width:46px;
 height:24px;
 background:#bfdbfe;
 border-radius:20px;
 position:relative;
 cursor:pointer;
 margin-left:20px;
}
.theme-switch::before{
 content:"";
 position:absolute;
 width:18px;
 height:18px;
 background:white;
 border-radius:50%;
 top:3px;
 left:3px;
 transition:.3s;
}
body.dark .theme-switch{background:#60a5fa;}
body.dark .theme-switch::before{transform:translateX(22px);}

/* Main */
.main{
 margin-left:220px;
 padding:30px;
}

/* Cards */
.cards{
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:20px;
 margin-bottom:30px;
}
.card{
 background:var(--card);
 padding:20px;
 border-radius:12px;
 box-shadow:0 4px 12px rgba(0,0,0,.08);
 transition:.2s;
}
.card:hover{transform:translateY(-4px);}
.card h3{margin:0;font-size:14px;color:var(--muted)}
.card p{font-size:28px;margin:8px 0 0;font-weight:600;color:var(--primary)}

/* Table */
table{
 width:100%;
 border-collapse:collapse;
 background:var(--card);
 border-radius:12px;
 overflow:hidden;
 box-shadow:0 4px 12px rgba(0,0,0,.08);
 margin-top:10px;
}
th,td{padding:12px 15px;text-align:left}
th{background:#e0e7ff;color:#1e3a8a;font-size:14px}
tr:nth-child(even){background:rgba(0,0,0,0.02)}

.delete-btn{
 color:#dc2626;
 font-weight:600;
 text-decoration:none;
}

.manage-btn{
 margin-top:25px;
 display:inline-block;
 background:var(--primary);
 color:white;
 padding:10px 18px;
 border-radius:8px;
 text-decoration:none;
 font-weight:600;
}
</style>

<script>
function toggleTheme(){
  document.body.classList.toggle("dark");
  localStorage.setItem("theme",
    document.body.classList.contains("dark") ? "dark":"light");
}
window.onload=function(){
  if(localStorage.getItem("theme")==="dark"){
    document.body.classList.add("dark");
  }
};
</script>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">
 <h2>SHEMS</h2>
 <a href="/adminScreen">Dashboard</a>
 <a href="/adminScreen/devices">Devices</a>
 <a href="/admin/analytics">Analytics</a> <!-- âœ… Added -->
 <a href="/logout">Logout</a>
</div>

<!-- Header -->
<div class="header">
 <h1>Admin Dashboard</h1>
 <div style="display:flex;align-items:center;gap:15px;">
   <div>Logged in as: <b th:text="${userDetails}"></b></div>
   <div class="theme-switch" onclick="toggleTheme()" title="Toggle Theme"></div>
 </div>
</div>

<!-- Main Content -->
<div class="main">

 <!-- Stats Cards -->
 <div class="cards">
  <div class="card">
   <h3>Total Users</h3>
   <p th:text="${totalUsers}">0</p>
  </div>
  <div class="card">
   <h3>Total Devices</h3>
   <p th:text="${totalDevices}">0</p>
  </div>
  <div class="card">
   <h3>Active Devices</h3>
   <p th:text="${activeDevices}">0</p>
  </div>
  <div class="card">
   <h3>Inactive Devices</h3>
   <p th:text="${inactiveDevices}">0</p>
  </div>
 </div>

 <!-- Users Table -->
 <h2>Registered Users</h2>

 <table>
  <tr>
   <th>Name</th>
   <th>Email</th>
   <th>Total Energy (kWh)</th>
   <th>Action</th>
  </tr>

  <tr th:each="user : ${users}">
   <td th:text="${user.name}"></td>
   <td th:text="${user.email}"></td>

   <td th:text="${userEnergyMap[user.id] != null ? #numbers.formatDecimal(userEnergyMap[user.id],1,3) + ' kWh' : '0 kWh'}"></td>

   <td>
    <a th:href="@{'/adminScreen/deleteUser/' + ${user.id}}" class="delete-btn">Delete</a>
   </td>
  </tr>
 </table>

 <!-- Manage Devices Button -->
 <a href="/adminScreen/devices" class="manage-btn">Manage All Devices</a>

</div>

</body>
</html>
